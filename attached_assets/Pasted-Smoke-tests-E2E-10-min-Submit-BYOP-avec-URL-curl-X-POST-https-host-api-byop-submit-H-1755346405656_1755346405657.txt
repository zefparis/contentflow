Smoke tests E2E (10 min)

Submit BYOP (avec URL)

curl -X POST https://<host>/api/byop/submit \
  -H 'Content-Type: application/json' \
  --cookie "partner_id=<PID>" \
  -d '{"source_url":"https://www.youtube.com/watch?v=XXXXX","title":"Hack IA","description":"â€¦","hashtags":"#ia #tools","cta":"Essaye â†’"}'


â†’ expect { ok:true, submissionId, assetId }

Pipeline pickup

Check asset passe new â†’ processing â†’ ready (GET /api/assets/:assetId ou ta page â€œGÃ©rerâ€).

VÃ©rifie que owner_partner_id est bien injectÃ© dans le meta.

Share Kit

curl "https://<host>/api/byop/kit?submissionId=<SID>" --cookie "partner_id=<PID>"


â†’ rÃ©cupÃ¨re shortUrl + shareText + intents (WA/TG/X).

Ouvre un intent â†’ vÃ©rifie lâ€™encodage (pas de + foireux).

Tracking

Hit shortUrl 2â€“3 fois (user-agents diffÃ©rents).

GET /api/metrics?partnerId=<PID>&kind=click&since=24h â†’ expect +N clics (EPC si dispo).

Email share (rate limit)

curl -X POST https://<host>/api/byop/email \
  --cookie "partner_id=<PID>" \
  -d "submissionId=<SID>&emails=a@b.com,c@d.com"


â†’ expect {ok:true} si < 200/j ; aprÃ¨s 200 â†’ HTTP 429.

VÃ©rifie prÃ©sence #ad + lien de dÃ©sinscription si Brevo branchÃ©.

Auth/isolement

Essaye /api/byop/kit?submissionId dâ€™un autre partenaire â†’ HTTP 401/404 (OK).

ğŸš€ Upgrades qui payent (safe, feature-flag)

Publish BYOP sur les comptes du partenaire (credentials-aware)

Flag: FEATURE_BYOP_PUBLISH=true.

Si PartnerAccount(platform=X) prÃ©sent â‡’ en plus du Share Kit, propose â€œPublier sur mes comptesâ€ â†’ route POST /api/byop/publish qui passe les tokens du partenaire Ã  tes publishers (fallback: Share Kit only).

Garde review ON par dÃ©faut (autopublish opt-in).

Payout dynamique par partenaire (EPC_7d partner-scoped)

Calcule epc_partner_7d = sum(amount_eur)/count(clicks) WHERE partner_id=:pid AND ts>=now()-7d.

CPC_partner = clamp(epc_partner_7d * revshare_pct â€“ safety_margin, [floor; ceiling]).

Affiche le barÃ¨me personnalisÃ© sur /partners/earnings (motivant + protÃ¨ge la marge).

Quality/anti-abus

pHash + text-sim sur BYOP pour dÃ©tecter doublons cross-partenaires â†’ cooldown 24h si trop proche.

Circuit-breaker email par domaine (Ã©vite bounces/spam traps) + blacklist de domaines jetables.

Cool-off Share Kit : 30 sec entre deux clics mÃªmes IP/UA â†’ soft-dedupe des clics.

ğŸ§© Micro-hooks UX (zero-risk)

1-click CTA dans Share Kit : â€œCopier toutâ€ + toasts.

PrÃ©-header â€œTu peux stopper Ã  tout momentâ€ (rÃ©duit anxiÃ©tÃ©).

Badges dynamiques â€œEPC 7j = Xâ‚¬â€ sur BYOP â€œGÃ©rerâ€.

ğŸ“ˆ Runbook prod (72h)

J0: Smoke tests ci-dessus, activer payout min 10â‚¬, pousser 10 partenaires pilotes.

J1: Activer FEATURE_BYOP_PUBLISH pour 3 pilotes â†’ publier 1 post/pilote/plateforme (review ON).

J2: Switch pricing â†’ CPC partner per-PID. Envoyer 1er email Brevo â€œTop posts Ã  partagerâ€.